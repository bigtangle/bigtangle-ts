import { beforeEach, describe, expect, test } from "vitest";
import { RemoteTest } from "./RemoteTest";
import { Utils } from "../../src/net/bigtangle/core/Utils";
import { Block } from "../../src/net/bigtangle/core/Block";


class RemoteBinaryTests extends RemoteTest {
  public logTransaction(block: Block): void {
    const transactions = block.getTransactions();
      if (transactions) {
        for (const t of transactions) {
           console.log(t.toString());
           console.log("Transaction hash: " + t.getHash().toString());
           console.log("Is coinbase: " + t.isCoinBase());

          if(t.isCoinBase()){
            console.log("Checking coinbase transaction with hash: " + t.getHash().toString());
           expect(t.getHash().toString()).toBe("73a3a625775cfaec1a6ebec2833eedb908a9693a0ef5bbf08f55c730f0061ed9");
          }
         }
      }
    }
}

describe("RemoteBinaryTests", () => {
  const tests = new RemoteBinaryTests();

  beforeEach(async () => {
    await tests.setUp();
  });

  test ("testSerial", async () => {
    const tip = "010000008e99896d03f3f22f1c27b9c37cd0af8fac76f1ac4a7ed40a29de505fac1d47008e99896d03f3f22f1c27b9c37cd0af8fac76f1ac4a7ed40a29de505fac1d4700fd5db1cb0e2181c50a4664cb5c07f1f3c4285dcf6b626bf4cdedca9c2755cd217bcf196900000000ae470120000000002600000000000000000000002bdf6a05a961cf27a47355486891ebb9ee6892f803000000510000000000000002010000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffff03020000ffffffff0000000001039896802102a717921ede2c066a4da05b9cdce203f1002b7e2abeee7546194498ef2fa9b13a232102a717921ede2c066a4da05b9cdce203f1002b7e2abeee7546194498ef2fa9b13aac0000000009000000546f6b656e496e666ffb0300007b2276657273696f6e223a312c22746f6b656e223a7b2276657273696f6e223a312c22626c6f636b48617368223a6e756c6c2c22636f6e6669726d6564223a66616c73652c227370656e74223a66616c73652c227370656e646572426c6f636b48617368223a6e756c6c2c2274696d65223a302c22746f6b656e696e646578223a302c22746f6b656e6e616d65223a22e4babae6b091e5b881222c226465736372697074696f6e223a22e4babae6b091e5b88120434e59222c22646f6d61696e4e616d65223a22424947222c22646f6d61696e4e616d65426c6f636b48617368223a2234383535663031396564306239376165376463666162383361303130633132643862616465663566363639353834653334363464383564356335396335376165222c227369676e6e756d626572223a302c22746f6b656e74797065223a342c22746f6b656e73746f70223a66616c73652c2270726576626c6f636b68617368223a6e756c6c2c22616d6f756e74223a223130303030303030222c22646563696d616c73223a322c22636c617373696669636174696f6e223a6e756c6c2c226c616e6775616765223a6e756c6c2c227265766f6b6564223a66616c73652c22746f6b656e4b657956616c756573223a6e756c6c2c22746f6b656e6964223a22303261373137393231656465326330363661346461303562396364636532303366313030326237653261626565653735343631393434393865663266613962313361227d2c226d756c74695369676e416464726573736573223a5b7b22626c6f636b68617368223a6e756c6c2c22746f6b656e6964223a22303261373137393231656465326330363661346461303562396364636532303366313030326237653261626565653735343631393434393865663266613962313361222c2261646472657373223a6e756c6c2c227075624b6579486578223a22303261373137393231656465326330363661346461303562396364636532303366313030326237653261626565653735343631393434393865663266613962313361222c22706f73496e646578223a302c22746f6b656e486f6c646572223a307d2c7b22626c6f636b68617368223a6e756c6c2c22746f6b656e6964223a22303261373137393231656465326330363661346461303562396364636532303366313030326237653261626565653735343631393434393865663266613962313361222c2261646472657373223a6e756c6c2c227075624b6579486578223a22303237323162356562303238326534626338366161623333383065326262613331643933356362613338363734316331353434373937333433326336316263393735222c22706f73496e646578223a302c22746f6b656e486f6c646572223a307d5d7d000000000f0000005b6f626a656374204f626a6563745d8e0100007b226d756c74695369676e42696573223a5b7b22746f6b656e6964223a22303261373137393231656465326330363661346461303562396364636532303366313030326237653261626565653735343631393434393865663266613962313361222c22746f6b656e696e646578223a302c2261646472657373223a226d6e7966706a5a557832556b327958515a39695545356e784b526877565851457746222c227075626c69636b6579223a22303261373137393231656465326330363661346461303562396364636532303366313030326237653261626565653735343631393434393865663266613962313361222c227369676e6174757265223a223330343430323230306266373661326334666561646538383631653331393465383034303938333861616231313137356161353239653837366131396435313832303662396165303032323032643234303930623662646136653633346631333638353934396132306637343838616665623138306166303064356366386132326330343436636462646264227d5d7d010000000152082cbb4d652231b0aea342fced7f666e5d63179c857b5b25b684387c79fc00465fb1449b36d117a83aeb6b2445430ed95d31f62aa8afa3018906ee0b53cdbc000000006a4730440220456e0c04c61c52b18616b92d82343045f43b48ce8798167a1d97e6337b85bde1022067a3188f62f2382995591579fe93d2c98228db1f369507d2ced6083c04f6707f012102a717921ede2c066a4da05b9cdce203f1002b7e2abeee7546194498ef2fa9b13affffffff010000000502540be40001bc1976a91451d65cb4f2e64551c447cd41635dd9214bbaf19d88ac010502540be01801bc232102a717921ede2c066a4da05b9cdce203f1002b7e2abeee7546194498ef2fa9b13aac000000000000000000000000000000000300000066656500000000";

        const serializer2 = tests.networkParameters.getDefaultSerializer();
    const block2 = serializer2.makeBlock(Buffer.from(Utils.HEX.decode(tip ))) ;
     console.log(block2.toString());

     tests.logTransaction(block2);

 

    // Post to the server
 /*   const url = tests.contextRoot + (ReqCmd.saveBlock || "/saveBlock");

      OkHttp3Util.post(url, Buffer.from(block.bitcoinSerialize()));
      */
  });
});