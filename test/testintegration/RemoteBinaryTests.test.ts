import { beforeEach, describe, expect, test } from "vitest";


import { RemoteTest } from "./RemoteTest";
import { Utils } from "../../src/net/bigtangle/core/Utils";


class RemoteBinaryTests extends RemoteTest {}

describe("RemoteBinaryTests", () => {
  const tests = new RemoteBinaryTests();

  beforeEach(async () => {
    await tests.setUp();
  });

  test ("testSerial", async () => {
    const tip = "010000007f28a0963057ff1c05531f696c6a6c709571d20bce09c964737bd134802302007f28a0963057ff1c05531f696c6a6c709571d20bce09c964737bd13480230200eca9934b76a82759b6540f8320cb12955238a276160ec2db37866ecc3ac969664cb50f6900000000ae47012000000000030000000000000038379dbc2bdf6a05a961cf27a47355486891ebb9ee6892f803000000080000000000000002010000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffff03020000ffffffff000000000104009896802102a717921ede2c066a4da05b9cdce203f1002b7e2abeee7546194498ef2fa9b13a232102a717921ede2c066a4da05b9cdce203f1002b7e2abeee7546194498ef2fa9b13aac0000000009000000546f6b656e496e666ffb0300007b2276657273696f6e223a312c22746f6b656e223a7b2276657273696f6e223a312c22626c6f636b48617368223a6e756c6c2c22636f6e6669726d6564223a66616c73652c227370656e74223a66616c73652c227370656e646572426c6f636b48617368223a6e756c6c2c2274696d65223a302c22746f6b656e696e646578223a302c22746f6b656e6e616d65223a22e4babae6b091e5b881222c226465736372697074696f6e223a22e4babae6b091e5b88120434e59222c22646f6d61696e4e616d65223a22424947222c22646f6d61696e4e616d65426c6f636b48617368223a2234383535663031396564306239376165376463666162383361303130633132643862616465663566363639353834653334363464383564356335396335376165222c227369676e6e756d626572223a302c22746f6b656e74797065223a342c22746f6b656e73746f70223a66616c73652c2270726576626c6f636b68617368223a6e756c6c2c22616d6f756e74223a223130303030303030222c22646563696d616c73223a322c22636c617373696669636174696f6e223a6e756c6c2c226c616e6775616765223a6e756c6c2c227265766f6b6564223a66616c73652c22746f6b656e4b657956616c756573223a6e756c6c2c22746f6b656e6964223a22303261373137393231656465326330363661346461303562396364636532303366313030326237653261626565653735343631393434393865663266613962313361227d2c226d756c74695369676e416464726573736573223a5b7b22626c6f636b68617368223a6e756c6c2c22746f6b656e6964223a22303261373137393231656465326330363661346461303562396364636532303366313030326237653261626565653735343631393434393865663266613962313361222c2261646472657373223a6e756c6c2c227075624b6579486578223a22303261373137393231656465326330363661346461303562396364636532303366313030326237653261626565653735343631393434393865663266613962313361222c22706f73496e646578223a302c22746f6b656e486f6c646572223a307d2c7b22626c6f636b68617368223a6e756c6c2c22746f6b656e6964223a22303261373137393231656465326330363661346461303562396364636532303366313030326237653261626565653735343631393434393865663266613962313361222c2261646472657373223a6e756c6c2c227075624b6579486578223a22303237323162356562303238326534626338366161623333383065326262613331643933356362613338363734316331353434373937333433326336316263393735222c22706f73496e646578223a302c22746f6b656e486f6c646572223a307d5d7d000000000f0000005b6f626a656374204f626a6563745d8e0100007b226d756c74695369676e42696573223a5b7b22746f6b656e6964223a22303261373137393231656465326330363661346461303562396364636532303366313030326237653261626565653735343631393434393865663266613962313361222c22746f6b656e696e646578223a302c2261646472657373223a226d6e7966706a5a557832556b327958515a39695545356e784b526877565851457746222c227075626c69636b6579223a22303261373137393231656465326330363661346461303562396364636532303366313030326237653261626565653735343631393434393865663266613962313361222c227369676e6174757265223a223330343430323230306266373661326334666561646538383631653331393465383034303938333861616231313137356161353239653837366131396435313832303662396165303032323032643234303930623662646136653633346631333638353934396132306637343838616665623138306166303064356366386132326330343436636462646264227d5d7d01000000014f90d117a73212ea43ae49f3d478893375455a91cf2447d5635022272906860056359509c9a9379ff51f13911de174d36ab4d2c026425eb3eb2b008f74ca0055000000006b483045022100e38787feb394b02aa63ad2352b419f38f7bcf8e20cd989c19c4d71bf336933de022078e357116bcc0a27f952bdf7ff0133315b31846bf22c4cb48a40597aad1def48012102a717921ede2c066a4da05b9cdce203f1002b7e2abeee7546194498ef2fa9b13affffffff01000000030f424001bc1976a91451d65cb4f2e64551c447cd41635dd9214bbaf19d88ac01030f3e5801bc232102a717921ede2c066a4da05b9cdce203f1002b7e2abeee7546194498ef2fa9b13aac000000000000000000000000000000000300000066656500000000";

    // Create a serializer with parseRetain set to true
    const serializer = tests.networkParameters.getSerializer(true);
    const block = serializer.makeBlock(Buffer.from(Utils.HEX.decode(tip ))) ;
 
  

     expect(Utils.HEX.encode(block.bitcoinSerialize())).toEqual(tip);
      const transactions = block.getTransactions();
      if (transactions) {
        for (const t of transactions) {
           console.log(t .toString() );
          console.log(t.getHash().toString() );
        }
      }

    console.log(block.toString());
  
    // Post to the server
 /*   const url = tests.contextRoot + (ReqCmd.saveBlock || "/saveBlock");
    
      OkHttp3Util.post(url, Buffer.from(block.bitcoinSerialize()));
      */
  }
      );
});
